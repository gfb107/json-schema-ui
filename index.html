<html language="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500">
    <title>Json Editor Test</title>
    <style type="text/css">
        body{
            margin: 0.5in;
            padding: 0;
            font-size: 14px;
            font-family: Roboto, sans-serif;
        }
    </style>
  </head>
  <body>
    <h2>JSON Editor Test</h2>
    <div id="target"></div>
    <script type="text/javascript">
      console.log( 'index script' );
      window.addEventListener( 'load', function() {
      console.log( 'on load' );
      const schema = {
        "title":"Contract for Demand Cutrailment Programs",
        "definitions":{
          "period":{
            "type":"string",
            "oneOf":[{
              "const":"earlyMorning","title":"Early Morning (Midnight to 6AM)"
            },{
              "const":"morning","title":"Morning (6AM to Noon)"
            },{
              "const":"afternoon","title":"Afternoon (Noon to 6PM)"
            },{
              "const":"night","title":"Night (6PM to Midnight)"
            }],
            "options":{"grid_columns":3}
          },
          "periodsOfDay":{
            "type":"array",
            "uniqueItems":true,
//            "format": "select",
            "minItems":1,
            "items":{"$ref":"#/definitions/period"},
            "default":["earlyMorning","morning","afternoon","night"]
          },
          "price":{
            "title":"Price",
            "type":"number",
            "minimum":0,
            "multipleOf":0.01
          },
          "adjustment":{
            "type":"number",
            "multipleOf":0.01
          },
          "periodPrices":{
            "type":"object",
            "format":"table",
            "properties":{
              "earlyMorning":{"$ref":"#/definitions/price"},
              "morning":{"$ref":"#/definitions/price"},
              "afternoon":{"$ref":"#/definitions/price"},
              "night":{"$ref":"#/definitions/price"}
            },
            "required":["earlyMorning","morning","afternoon","night"],
            "default":{"earlyMorning":0,"morning":0,"afternoon":0,"night":0}
          },
          "seasonalAdjustments":{
            "type":"object",
            "format":"table",
            "properties":{
              "spring":{"$ref":"#/definitions/periodPrices"},
              "summer":{"$ref":"#/definitions/periodPrices"},
              "fall":{"$ref":"#/definitions/periodPrices"},
              "winter":{"$ref":"#/definitions/periodPrices"}
            },
            "required": [ "spring", "summer", "fall", "winter" ]
          },
          "rateTable":{
            "type":"object",
            "properties":{
              "base":{"$ref":"#/definitions/periodPrices"},
              "seasonalAdjustments":{"$ref":"#/definitions/seasonalAdjustments"}
            },
            "required":["base"],
            "default":{
              "base":{"earlyMorning":0,"morning":0,"afternoon":0,"night":0}
            }
          }
        },
        "type":"object",
        "format":"horizontal",
        "properties":{
          "committedCapacity":{
            "title":"Committed Capacity (MW)",
            "description":"The amount of the demand curtailment you commit to provide when called upon",
            "type":"number",
            "minimum":0.001,
            "multipleOf":0.001
          },
          "availability":{
            "type":"object",
            "properties":{
              "weekDayPeriods":{"$ref":"#/definitions/periodsOfDay"},
              "weekEndPeriods":{"$ref":"#/definitions/periodsOfDay"}
            },
            "required":["weekDayPeriods"]
          },
          "monthlyCalls":{
            "title":"Maximum number of uses each month",
            "type":"integer",
            "minimum":1,
            "maximim":100,
            "default":4,
            "options":{"input_width":"5em"}},
            "maximumDuration":{
              "title":"Maximum duration of each use, in hours",
              "type":"integer",
              "minimum":1,
              "maximum":24,
              "default":2,
              "options":{"input_width":"4em"}
            },
            "responseTime":{
              "title":"Maximum Response Time",
              "description":"The asset must be activated within the specified number of minutes",
              "type":"integer",
              "minimum":1,
              "maximum":30,
              "default":10,
              "options":{"input_width":"4em"}
            },
            "paymentPlan":{
              "type":"object",
              "minProperties":1,
              "properties":{
                "demand":{
                  "title":"Demand",
                  "description":"Dollars / Peak kW in month",
                  "$ref":"#/definitions/rateTable"
                },
                "energy":{
                  "title":"Energy",
                  "description":"Dollars / Total kWh in month",
                  "$ref":"#/definitions/rateTable"
                }
              }
            },
            "penalties":{
              "type":"object",
              "format":"grid",
              "properties":{
                "failureToRespond":{
                  "type":"integer",
                  "description":"Dollar amount charged for failing to respond when called",
                  "default":100,
                  "options":{"input_width":"33%"}
                },
                "partialExecution":{
                  "type":"integer",
                  "description":"Dollar amount charged for ending execution prematurely",
                  "default":100,
                  "options":{"input_width":"33%"}
                },
                "demandIncrease":{
                  "type":"integer",
                  "description":"Dollar amount charged for increasing demand when called to curtail demand",
                  "default":100,
                  "options":{"input_width":"33%"}
                }
              },
              "required":["failureToRespond","partialExecution","demandIncrease"]
            }
          },
          "required":["committedCapacity","availability","responseTime","paymentPlan","penalties"]
        };

        const value = {
          "committedCapacity" : 3.6,
          "availability" : {
            "weekDayPeriods" : [
              "earlyMorning",
              "morning",
              "afternoon",
              "night"
            ],
            "weekEndPeriods" : [
              "morning",
              "afternoon",
              "night"
            ]
          },
          "monthlyCalls" : 4,
          //			    "maximumDuration" : 2,
          "responseTime" : 10,
          "paymentPlan" : {
            "demand" : {
              "base" : {
                "earlyMorning" : 0,
                "morning" : 0,
                "afternoon" : 0,
                "night" : 0
              },
              "seasonalAdjustments" : {
                "spring": {
                  "earlyMorning" : 0,
                  "morning" : 0,
                  "afternoon" : 0,
                  "night" : 0
                },
                "summer" : {
                  "earlyMorning" : 0,
                  "morning" : 0,
                  "afternoon" : 0,
                  "night" : 0
                },
                "fall": {
                  "earlyMorning" : 0,
                  "morning" : 0,
                  "afternoon" : 0,
                  "night" : 0
                },
                "winter": {
                  "earlyMorning" : 0,
                  "morning" : 0,
                  "afternoon" : 0,
                  "night" : 0
                }
              }
            },
            "energy" : {
              "base" : {
                "earlyMorning" : 0,
                "morning" : 0,
                "afternoon" : 0,
                "night" : 0
              },
              "seasonalAdjustments" : {
                "spring": {
                  "earlyMorning" : 0,
                  "morning" : 0,
                  "afternoon" : 0,
                  "night" : 0
                },
                "summer" : {
                  "earlyMorning" : 0,
                  "morning" : 0,
                  "afternoon" : 0,
                  "night" : 0
                },
                "fall": {
                  "earlyMorning" : 0,
                  "morning" : 0,
                  "afternoon" : 0,
                  "night" : 0
                },
                "winter": {
                  "earlyMorning" : 0,
                  "morning" : 0,
                  "afternoon" : 0,
                  "night" : 0
                }
              }
            }
          },
          "penalties" : {
            "failureToRespond" : 100,
            "partialExecution" : 100,
            "demandIncrease" : 100
          }
        };
        const container = document.getElementById( 'target' );
        const editor = JsonHelper.editor({ value, schema, container });
        editor.on( 'change', ( editor, data ) => console.log( 'EditorTest.onChange', editor, data ));
    })
    </script>
  </body>
</html>
